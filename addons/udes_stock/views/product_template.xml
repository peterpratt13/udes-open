<?xml version="1.0"?>
<odoo>
    <record id="view_product_template_form_view_udes" model="ir.ui.view">
        <field name="name">Changes to product form</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_form_view"/>
        <field name="arch" type="xml">

            <!-- Add a confirmation to the "Archive" button. -->
            <xpath expr="//button[@name='toggle_active']" position="attributes">
                <attribute name="confirm">Are you sure you want to archive this product? It will become unavailable and hidden from searches.</attribute>
            </xpath>

            <xpath expr="//page[@name='inventory']" position="inside">
                <group string="UDES" name="inventory_udes">
                    <field name="u_hazardous" />
                    <field name="u_height_category_id" />
                    <field name="u_speed_category_id" />
                    <field name="u_manufacturer_part_no" />
                    <field name="u_pallet_qty" />
                </group>

            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="product_template_form_view_procurement_button_udes_stock">
        <field name="name">product.template_procurement.udes_stock</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="stock.product_template_form_view_procurement_button"/>
        <field name="arch" type="xml">
            <!-- Set on hand button show for readonly desktop users -->
            <xpath expr="//button[@name='action_open_quants']" position="attributes">
                <attribute name="readonly_user_exception">1</attribute>
            </xpath>
        </field>
    </record>

    <record id="product_template_search_view" model="ir.ui.view">
        <field name="name">product.template.search</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_search_view"/>
        <field name="arch" type="xml">
            <field name="name" position="replace">
                <field name="name" string="Product" filter_domain="['|','|','|',('default_code','ilike',self),('name','ilike',self),('barcode','ilike',self),('u_manufacturer_part_no','ilike',self)]"/>
                <field name="u_manufacturer_part_no" />
            </field>
            <!-- Add a new filter for Active products, as we now include inactive by default -->
            <filter name="inactive" position="after">
                <filter string="Active" name="active" domain="[('active','=',True)]"/>
            </filter>
        </field>
    </record>

    <menuitem id="stock.product_product_menu" active="false"/>

    <!-- Extend template actions to include inactive products in context
    which results in archived templates still showing a barcode from the related field,
    as m2o relations are hidden via the ORM when the linked recordset is inactive - even if
    the context is set on the barcode field (related seems to ignore context);
    >>> self.env["product.template"].browse(xxx).product_variant_ids
    product.product()
    >>> self.env["product.template"].browse(xxx).with_context(dict(active_test=False)).product_variant_ids
    product.product(xxx,)
    Also include a default filter 'Active is false' to hide them by default -->
    <record id="product.product_template_action" model="ir.actions.act_window">
        <field name="context">{"search_default_filter_to_sell":1, "active_test": False, "search_default_active": 1}</field>
    </record>
    <record id="stock.product_template_action_product" model="ir.actions.act_window">
        <field name="context">{"search_default_consumable": 1, 'default_type': 'product', "active_test": False, "search_default_active": 1}</field>
    </record>

</odoo>
